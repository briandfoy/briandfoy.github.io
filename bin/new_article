#!/usr/local/bin/ruby

require 'erb'
require 'readline'
require 'pathname'

def input(prompt = "", default = "" )
  answer = Readline.readline(prompt, true).squeeze(" ").strip
  answer.length > 0 ? answer : default
end

def slugify( title )
	slug = title.downcase
	# http://mywiki.wooledge.org/BashGuide/SpecialCharacters
	slug.gsub!( /[^a-zA-Z0-9]+/, "-" )
	slug.sub!( /^-+/, "" );
	slug.sub!( /-+$/, "" );
	return slug
end

template = ERB.new( <<~HERE )
	---
	layout: post
	title: <%= title %>
	categories:
	tags:
	stopwords:
	last_modified:
	original_url: <%= original %>
	---

	The article goes here

	HERE

title = input( "title? ", "Change this title" )

now = "%4d-%02d-%02d" % [
	Time.now.year,
	Time.now.month,
	Time.now.day,
	]
date = input( "date? ", now )
original = input( "Original URL? ", now )

base_path = Pathname.new( "_drafts" )
filename = "%s-%s.md" % [
	date,
	slugify(title)
	]

result = template.result()
path = base_path + filename
File.open( path, "w" ) { |fh| fh.write(result) }
